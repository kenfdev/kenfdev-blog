---
import { SITE_TITLE } from '@/lib/config';
import type { Lang } from '@/lib/config';
import { t, getOtherLang } from '@/lib/i18n';
import '@/styles/global.css';

interface Props {
  title: string;
  description: string;
  lang: Lang;
  canonical?: string;
  alternateUrl?: string;
  alternateLang?: Lang;
  ogType?: 'website' | 'article';
  ogImage?: string;
}

const {
  title,
  description,
  lang,
  canonical,
  alternateUrl,
  alternateLang,
  ogType = 'website',
  ogImage,
} = Astro.props;

const fullTitle = `${title} | ${SITE_TITLE}`;
const siteUrl = Astro.site?.origin || '';
const canonicalUrl = canonical || Astro.url.href;
const otherLang = getOtherLang(lang);
---

<!doctype html>
<html lang={lang}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LYMR4GCDBM"></script>
    <script is:inline>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-LYMR4GCDBM');
    </script>

    <!-- Favicons -->
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <meta name="theme-color" content="#1E88E5" />
    <title>{fullTitle}</title>
    <meta name="description" content={description} />
    <link rel="canonical" href={canonicalUrl} />

    <!-- hreflang -->
    <link rel="alternate" hreflang={lang} href={canonicalUrl} />
    {alternateUrl && <link rel="alternate" hreflang={alternateLang} href={alternateUrl} />}
    <link rel="alternate" hreflang="x-default" href={`${siteUrl}/en/`} />

    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" title={`RSS (${lang.toUpperCase()})`} href={`${siteUrl}/${lang}/rss.xml`} />
    <link rel="alternate" type="application/rss+xml" title="RSS (All)" href={`${siteUrl}/rss.xml`} />

    <!-- OGP -->
    <meta property="og:title" content={fullTitle} />
    <meta property="og:description" content={description} />
    <meta property="og:url" content={canonicalUrl} />
    <meta property="og:type" content={ogType} />
    <meta property="og:locale" content={lang === 'ja' ? 'ja_JP' : 'en_US'} />
    {ogImage && (
      <>
        <meta property="og:image" content={ogImage} />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="630" />
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:image" content={ogImage} />
      </>
    )}
  </head>
  <body>
    <header class="site-header">
      <div class="header-inner">
        <a href={`/${lang}/`} class="site-title">
          <img src="/assets/logo.png" alt={SITE_TITLE} class="site-logo" />
          <span>{SITE_TITLE}</span>
        </a>
        <nav class="site-nav">
          <a href={`/${lang}/posts/`}>{t(lang, 'posts')}</a>
          <a href={`/${lang}/rss.xml`}>{t(lang, 'rss')}</a>
          {alternateUrl ? (
            <a href={alternateUrl} class="lang-switch">{t(lang, 'langSwitch')}</a>
          ) : (
            <a href={`/${otherLang}/`} class="lang-switch">{t(lang, 'langSwitch')}</a>
          )}
        </nav>
      </div>
    </header>

    <main class="site-main">
      <slot />
    </main>

    <footer class="site-footer">
      <p>&copy; {new Date().getFullYear()} {SITE_TITLE}. All rights reserved.</p>
    </footer>
  </body>
</html>
